console.log("UX Refactor Assistant content script loaded");chrome.runtime.onMessage.addListener((t,e,n)=>{switch(console.log("Content script received message:",t),t.type){case"EXTRACT_JSX":return p(n),!0;case"ANALYZE_ELEMENTS":return d(n),!0;default:n({error:"Unknown message type"})}});function p(t){try{const e=f();t({success:!0,jsx:e})}catch(e){console.error("JSX extraction failed:",e),t({error:"Failed to extract JSX"})}}function d(t){try{const e=y();t({success:!0,analysis:e})}catch(e){console.error("Element analysis failed:",e),t({error:"Failed to analyze elements"})}}function f(){if(window.__REACT_DEVTOOLS_GLOBAL_HOOK__){const e=window.__REACT_DEVTOOLS_GLOBAL_HOOK__.renderers;if(e&&e.size>0){const n=e.values().next().value;if(n&&n.getFiberRoots){const s=n.getFiberRoots();if(s.size>0){const a=s.values().next().value;return g(a.current)}}}}return m()}function g(t){var a,o;if(!t)return"";const e=((a=t.type)==null?void 0:a.name)||((o=t.type)==null?void 0:o.displayName)||(typeof t.type=="string"?t.type:"Unknown");let n=`<${e}`;t.memoizedProps&&Object.entries(t.memoizedProps).forEach(([c,r])=>{c!=="children"&&r!==void 0&&(typeof r=="string"?n+=` ${c}="${r}"`:n+=` ${c}={${JSON.stringify(r)}}`)});let s=t.child;if(s){for(n+=`>
`;s;)n+="  "+g(s),s=s.sibling;n+=`</${e}>`}else n+=" />";return n}function m(){const t=document.body;return t?h(t):""}function h(t,e=0){var c;const n="  ".repeat(e),s=t.tagName.toLowerCase();let a=`${n}<${s}`;Array.from(t.attributes).forEach(r=>{r.name!=="class"&&(a+=` ${r.name}="${r.value}"`)}),t.className&&(a+=` className="${t.className}"`);const o=Array.from(t.children);return o.length>0?(a+=`>
`,o.forEach(r=>{a+=h(r,e+1)+`
`}),a+=`${n}</${s}>`):(c=t.textContent)!=null&&c.trim()?a+=`>${t.textContent.trim()}</${s}>`:a+=" />",a}function y(){const t=document.querySelectorAll("button, input, a, p, h1, h2, h3, h4, h5, h6, div, span"),e={totalElements:t.length,buttons:0,inputs:0,links:0,headings:0,paragraphs:0,potentialIssues:[]};return t.forEach(n=>{switch(n.tagName.toLowerCase()){case"button":e.buttons++;break;case"input":e.inputs++;break;case"a":e.links++;break;case"h1":case"h2":case"h3":case"h4":case"h5":case"h6":e.headings++;break;case"p":e.paragraphs++;break}const a=x(n);e.potentialIssues.push(...a)}),e}function x(t){const e=[],n=window.getComputedStyle(t),s=n.backgroundColor,a=n.color;if(s&&a&&s!=="transparent"){const r=w(s,a),u=L(t)?3:4.5;r<u&&e.push({type:"contrast",severity:"error",message:`Low contrast ratio: ${r.toFixed(2)}:1 (needs ${u}:1)`,element:t.tagName.toLowerCase()})}const o=parseFloat(n.margin)||0,c=parseFloat(n.padding)||0;if(o>0||c>0){const r=o+c,i=b(r,[2,4,8,12,16,20,24,32,40,48,64,80,96]);Math.abs(r-i)>2&&e.push({type:"spacing",severity:"warn",message:`Inconsistent spacing: ${r}px (suggest ${i}px)`,element:t.tagName.toLowerCase()})}return e}function w(t,e){const n=l(t),s=l(e),a=Math.max(n,s),o=Math.min(n,s);return(a+.05)/(o+.05)}function l(t){const e=E(t);if(!e)return 0;const[n,s,a]=e.map(o=>(o=o/255,o<=.03928?o/12.92:Math.pow((o+.055)/1.055,2.4)));return .2126*n+.7152*s+.0722*a}function E(t){const e=t.match(/rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*[\d.]+)?\)/);if(e)return[parseInt(e[1]),parseInt(e[2]),parseInt(e[3])];const n=t.match(/#([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})/i);return n?[parseInt(n[1],16),parseInt(n[2],16),parseInt(n[3],16)]:null}function L(t){const e=window.getComputedStyle(t),n=parseFloat(e.fontSize),s=parseInt(e.fontWeight)||400;return n>=18||n>=14&&s>=700}function b(t,e){return e.reduce((n,s)=>Math.abs(s-t)<Math.abs(n-t)?s:n)}
